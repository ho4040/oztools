<!DOCTYPE HTML>

<meta charset="utf-8">

<head>
	<link rel="stylesheet" type="text/css" href="http://ajax.googleapis.com/ajax/libs/jqueryui/1.11.1/themes/ui-lightness/jquery-ui.css">
	<script src="https://code.jquery.com/jquery-2.1.3.min.js"></script>
	<script src="https://code.jquery.com/ui/1.11.3/jquery-ui.js"></script>
	<link rel="stylesheet" type="text/css" href="site.css">

	<script type="text/javascript" src="https://101.livere.co.kr/js/livere8_lib.js" charset="utf-8"></script>

</head>

<body>
	<h1>WHITE ERASER </h1>
	
	<img src="http://i.imgur.com/v5vN99w.png" style='border-radius: 10px'><br>
	위 예제처럼 그림에서 흰색을 투명한 색으로 만들어줍니다.<br>
	
	<ol>
	<li>그림파일을 불러옵니다.</li>
	<li>썸네일을 목록에서 선택합니다.</li>
	<li>하단에 바뀐 이미지가 보이면 마우스 오른쪽 클릭, 다른이름으로 저장!</li>
	</ol>

	<input type="file" id="files" name="files[]" multiple />

	<div id="dragDiv" class="dragBox">	
		<output id="list"><p id="dragLabel" class="centerP">파일을 이곳에 드래그하세요(Drag files here)</p></output>
	</div>
	<canvas id="myCanvas"  class="scr" /></canvas>

	<hr>


	<img src="http://i.imgur.com/R0bthfI.png"><br>
	<a href="https://github.com/ho4040/WhiteEraser/releases" target="_blank">흰색지우개 오프라인 버젼 다운로드</a><br>

	<script>
		////////////////////////////////////////////////////////////
		//on File select
		////////////////////////////////////////////////////////////
		function handleFileSelect(evt){
		
			var files = evt.target.files || evt.dataTransfer.files;
			
			if(evt.type=="change"){ //by fileSelect Input
			}
			else{					//by Drag and drop
				FileDragHover(evt);
				document.getElementById("files").innerHTML = "파일" + files.length + "개";
			}
			
			document.getElementById('list').innerHTML = "";
			
			// Loop through the FileList and render image files as thumbnails.
			for (var i = 0, f; f = files[i]; i++)
			{
				// Only process image files.
				if (!f.type.match('image.*')) {
					continue;
				}

				var reader = new FileReader();
				var theFile = f; //for closure
				reader.onload = function(e){
					var span = document.createElement('span');
					var img = document.createElement('img');
					img.className = "thumb";
					img.src = e.target.result;
					img.addEventListener("click", onImageSelect);
					span.appendChild(img);
					document.getElementById('list').insertBefore(span, null);
				};
				
				// Read in the image file as a data URL.
				reader.readAsDataURL(f);
				
			}
		}
		
		////////////////////////////////////////////////////////////
		//load Image
		////////////////////////////////////////////////////////////
		function loadImage(dataURL){
			var canvas = document.getElementById("myCanvas");
			var imgObj = new Image();
			imgObj.onload  = function( e ){
				canvas.width  = imgObj.width;
				canvas.height  = imgObj.height;
				var context = canvas.getContext("2d");
				context.drawImage(imgObj, 0,0);
				//canvas.toDataURL("image/png");
				runImageProc();
			}
			imgObj.src = dataURL;
		}
		
		////////////////////////////////////////////////////////////
		//convert image data
		////////////////////////////////////////////////////////////
		function runImageProc(){
			var canvas = document.getElementById("myCanvas");
			var w = canvas.width;
			var h = canvas.height;
			var ctx = canvas.getContext("2d");
			var imgData = ctx.getImageData(0, 0, w, h );
			

			//Convert Pixels
			
			for(y=0;y<h;y++)
			{
				for(x=0;x<w;x++)
				{
					var index = (x + y * imgData.width) * 4;
					var r = imgData.data[index+0];
					var g = imgData.data[index+1];
					var b = imgData.data[index+2];
					var a = imgData.data[index+3];
					
					//calculate brightness (0x00~0xFF);
					var brightness = (r+g+b)/3;
					
					imgData.data[index+0] = 0;
					imgData.data[index+1] = 0;
					imgData.data[index+2] = 0;
					imgData.data[index+3] = 0xFF-brightness;
				}
			}
			
			ctx.putImageData(imgData, 0, 0);
			
			
		}
		
		////////////////////////////////////////////////////////////
		//on roll over
		////////////////////////////////////////////////////////////
		function FileDragHover(e) {
			e.stopPropagation();
			e.preventDefault();
			e.currentTarget.className = (e.type == "dragover" ? "dragBoxHover" : "dragBox");
		}
		
		////////////////////////////////////////////////////////////
		//on Image Select
		////////////////////////////////////////////////////////////
		var curImg = null;
		function onImageSelect(e){
			if(curImg != null){
				curImg.className = "thumb";
			}
			e.currentTarget.className = "thumbSelected";
			curImg = e.currentTarget;
			
			loadImage(curImg.src);
		}

		////////////////////////////////////////////////////////////
		//initialize codes
		////////////////////////////////////////////////////////////
		
		document.getElementById('files').addEventListener('change', handleFileSelect, false);
		var filedrag = document.getElementById("dragDiv");
		filedrag.addEventListener("dragover", FileDragHover, false);
		filedrag.addEventListener("dragleave", FileDragHover, false);
		filedrag.addEventListener("drop", handleFileSelect, false);	
		

		
	</script>

	<script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
	<!-- oztoolz 하단 -->
	<ins class="adsbygoogle"
	     style="display:inline-block;width:728px;height:90px"
	     data-ad-client="ca-pub-7591234085278110"
	     data-ad-slot="6842115581"></ins>
	<script>
	(adsbygoogle = window.adsbygoogle || []).push({});
	</script>


</body>
