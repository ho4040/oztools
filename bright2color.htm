
<head>

	<link rel="stylesheet" type="text/css" href="http://ajax.googleapis.com/ajax/libs/jqueryui/1.11.1/themes/ui-lightness/jquery-ui.css">
	<script src="https://code.jquery.com/jquery-2.1.3.min.js"></script>
	<script src="https://code.jquery.com/ui/1.11.3/jquery-ui.js"></script>
	<link rel="stylesheet" type="text/css" href="site.css">

	<script>
	  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
	  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
	  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
	  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

	  ga('create', 'UA-59101417-1', 'auto');
	  ga('send', 'pageview');
	</script>
	
	<script type="text/javascript" src="https://101.livere.co.kr/js/livere8_lib.js" charset="utf-8"></script>



	<!--json-->

	<script src="lib/json2.js"></script>

	<!-- color picker -->
	<link type="text/css" rel="stylesheet" href="lib/colorpicker/css/colorpicker.css" />
	<script src="lib/colorpicker/js/colorpicker.js" type="text/javascript" charset="utf-8"></script>

	<!-- gradx -->
	<link type="text/css" rel="stylesheet" href="lib/gradx/gradX.css" />
	<script src="lib/gradx/gradX.js"></script>

</head>
<body>

	<h1>BRIGHT2COLOR </h1>

	<script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
	<!-- oztools -->
	<ins class="adsbygoogle"
	     style="display:inline-block;width:728px;height:90px"
	     data-ad-client="ca-pub-7591234085278110"
	     data-ad-slot="2498809180"></ins>
	<script>
	(adsbygoogle = window.adsbygoogle || []).push({});
	</script><br>
	
	<img src='http://i.imgur.com/rzKFzv4.jpg' style='border-radius: 10px'><br>
	밝기에 따라서 색을 지정 할 수 있습니다.(Set colors by gradient setting.)<br>
	<ol>
	<li>원하는 그림파일들을 불러오세요.(load image files what you want to adjust)</li>
	<li>밝기별 색상을 설정합니다.(set colors by brightness)</li>
	<li>Source images에서 원하는 이미지를 선택한 후 Color setting의 Run 버튼을 누릅니다.(Select image from loaded image list and click 'run' from Color setting area.)</li>
	<li>Result에 결과가 보입니다. 이때 마우스 오른쪽 클릭을 하여 파일로 저장 할 수 있습니다.(Then you can see the result. you can save as file with right click)</li>
	</ol>
	<H3>Source images</H3>	
	<input type="file" id="files" name="files[]" multiple />
	<div>
		<div id="dragDiv" class="dragBox">	
			<output id="list"><p id="dragLabel" class="centerP">파일을 이곳에 드래그하세요(Drag files here)</p></output>
		</div>	
	</div>
	<H3>Color setting</H3>	
	<div style="width:100%">
		<div id="gradx" ></div>
		<div id="gradx_result" style="background-color:silver;" ></div>
	</div>
	<H3>Result</H3>	
	<canvas id="myCanvas"  class="scr" /></canvas>

	<br>

	<!-- 2. 아래 코드는 라이브리를 설치하시고자 하는 위치에 삽입하시기 바랍니다. -->
	<div id="livereContainer">
		<script type="text/javascript">
			var consumer_seq 	= "200";
			var livere_seq 		= "22695";
			var smartlogin_seq 	= "228";

			var title = "bright2color"
			var refer = "http://ho4040.github.io/oztools/index.htm?p=bright2color"

			livereReply = new Livere( livere_seq , refer , title );
			livereLib.start();
		</script>
	</div>

	<p class="bottom">
	by OZTOOLS( <a href="http://ho4040.github.io/oztools/">http://ho4040.github.io/oztools/</a>)
	<p>

	</p><br>


</body>


<script>
	////////////////////////////////////////////////////////////
	//on File select
	////////////////////////////////////////////////////////////
	function handleFileSelect(evt){
	
		var files = evt.target.files || evt.dataTransfer.files;
		
		if(evt.type=="change"){ //by fileSelect Input
		}
		else{					//by Drag and drop
			FileDragHover(evt);
			document.getElementById("files").innerHTML = "파일" + files.length + "개";
		}
		
		document.getElementById('list').innerHTML = "";
		
		// Loop through the FileList and render image files as thumbnails.
		for (var i = 0, f; f = files[i]; i++)
		{
			// Only process image files.
			if (!f.type.match('image.*')) {
				continue;
			}

			var reader = new FileReader();
			var theFile = f; //for closure
			reader.onload = function(e){
				var span = document.createElement('span');
				var img = document.createElement('img');
				img.className = "thumb";
				img.src = e.target.result;
				img.addEventListener("click", onImageSelect);
				span.appendChild(img);
				document.getElementById('list').insertBefore(span, null);
			};
			
			// Read in the image file as a data URL.
			reader.readAsDataURL(f);
			
		}
	}
	
	////////////////////////////////////////////////////////////
	//load Image
	////////////////////////////////////////////////////////////
	var lastImg = null;
	function loadImage(dataURL, callback){
		var canvas = document.getElementById("myCanvas");
		var imgObj = new Image();
		imgObj.onload  = function( e ){
			canvas.width  = imgObj.width;
			canvas.height  = imgObj.height;
			var context = canvas.getContext("2d");
			context.drawImage(imgObj, 0,0);
			lastImg = imgObj;
			if(callback)
				callback();
		}
		imgObj.src = dataURL;
	}
	
	function getColor(colorSet, bright){
		var b = bright / 255.0		
		if(b == 1)b = 0.99999
		if(b == 0)b = 0.00001
		var next = null
		var last = null
		for(i in colorSet){
			var c = colorSet[i]
			var p = c[4]  //slider position
			if(b < p){
				next = colorSet[i];
				last = colorSet[i-1];
				break
			}
		}
		var fl = next[4] - last[4]
		var ll = b - last[4]
		var r = ll/fl
		return [
			last[0]+(next[0] - last[0])*r,
			last[1]+(next[1] - last[1])*r,
			last[2]+(next[2] - last[2])*r,
			last[3]+(next[3] - last[3])*r
		];
	}

	////////////////////////////////////////////////////////////
	//convert image data
	////////////////////////////////////////////////////////////
	function runImageProc(colorSet){
		var canvas = document.getElementById("myCanvas");
		var w = canvas.width;
		var h = canvas.height;
		var ctx = canvas.getContext("2d");
		ctx.drawImage(lastImg, 0,0);
		var imgData = ctx.getImageData(0, 0, w, h );

		//Convert Pixels
		
		for(y=0;y<h;y++)
		{
			for(x=0;x<w;x++)
			{
				var index = (x + y * imgData.width) * 4;
				var r = imgData.data[index+0];
				var g = imgData.data[index+1];
				var b = imgData.data[index+2];
				var a = imgData.data[index+3];
				
				
				c = getColor(colorSet, (r+g+b)/3)

				imgData.data[index+0] = c[0];
				imgData.data[index+1] = c[1];
				imgData.data[index+2] = c[2];
				imgData.data[index+3] = a;
				
			}
		}
		
		ctx.putImageData(imgData, 0, 0);
		
		
	}
	
	////////////////////////////////////////////////////////////
	//on roll over
	////////////////////////////////////////////////////////////
	function FileDragHover(e) {
		e.stopPropagation();
		e.preventDefault();
		e.currentTarget.className = (e.type == "dragover" ? "dragBoxHover" : "dragBox");
	}
	
	////////////////////////////////////////////////////////////
	//on Image Select
	////////////////////////////////////////////////////////////
	var curImg = null;
	function onImageSelect(e){
		if(curImg != null){
			curImg.className = "thumb";
		}
		e.currentTarget.className = "thumbSelected";
		curImg = e.currentTarget;
		
		loadImage(curImg.src, null);
	}

	$(function() {
		gradX('#gradx', {
			sliders: [
			   {
				 color: "rgb(0, 0, 0)",
				 position: 0
			   },
			   {
				 color: "rgb(255, 255, 255)",
				 position: 100
			   }
			]			
		})
		$(".gradx_slectboxes").remove();
		$("#gradx_show_code").remove();
		//$("#gradx").dialog({"title":"그라데이션 지정", "width":510, "height":500 });
		document.getElementById('files').addEventListener('change', handleFileSelect, false);
		var filedrag = document.getElementById("dragDiv");
		filedrag.addEventListener("dragover", FileDragHover, false);
		filedrag.addEventListener("dragleave", FileDragHover, false);
		filedrag.addEventListener("drop", handleFileSelect, false);	

		$("#gradx_stop_sliders_gradx").before("<div id='grayBar'></div>")
		$("#proc_run_button").on("click", function(){
			var colorSet = [];
			for( i in gradx.sliders ){
				var obj = gradx.sliders[i]
				var colorStr = obj[0]
				var position = obj[1]
				var values = colorStr.match(/[\d\.]+/g);
				var colorInfo = [];
				var brightness = position / 100;
				if(colorStr.indexOf('rgba')==0)
					colorInfo = [Number(values[0]),Number(values[1]),Number(values[2]),Number(values[3])]
				else
					colorInfo = [Number(values[0]),Number(values[1]),Number(values[2]), 255]
				colorInfo.push(brightness)
				colorSet.push(colorInfo);
			}
			//$("#gradx_result").html(colorSet.join("<br>"))

			if(colorSet[0][4] != 0)
				colorSet.unshift([colorSet[0][0],colorSet[0][1],colorSet[0][2],colorSet[0][3],0])		
			if(colorSet[colorSet.length-1][4] != 1)
				colorSet.push([colorSet[colorSet.length-1][0],colorSet[colorSet.length-1][1],colorSet[colorSet.length-1][2],colorSet[colorSet.length-1][3],1])
			
			loadImage(curImg.src, function(){
				runImageProc(colorSet);
			});
			
		})
	    //$( "div, p" ).disableSelection();
	
	});
</script>

