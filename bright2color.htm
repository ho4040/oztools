<h1>B2C Tool</h1>
batch color by brightness.
<head>
<!-- jquery -->
<link rel="stylesheet" type="text/css" href="http://ajax.googleapis.com/ajax/libs/jqueryui/1.11.1/themes/ui-lightness/jquery-ui.css">
<script src="https://code.jquery.com/jquery-2.1.3.min.js"></script>
<script src="https://code.jquery.com/ui/1.11.3/jquery-ui.js"></script>

<!--json-->

<script src="lib/json2.js"></script>

<!-- color picker -->
<link type="text/css" rel="stylesheet" href="lib/colorpicker/css/colorpicker.css" />
<script src="lib/colorpicker/js/colorpicker.js" type="text/javascript" charset="utf-8"></script>

<!-- gradx -->
<link type="text/css" rel="stylesheet" href="lib/gradx/gradX.css" />
<script src="lib/gradx/gradX.js"></script>

<link rel="stylesheet" type="text/css" href="default.css">

</head>
<body>

<input type="file" id="files" name="files[]" multiple />
<div>
	<div id="dragDiv" class="dragBox">	
		<output id="list"><p id="dragLabel" class="centerP">파일을 이곳에 드래그하세요(Drag files here)</p></output>
	</div>	
</div>
Color match setting<br>
<div style="width:100%">
	<div id="gradx" ></div>
	<div id="gradx_result" style="background-color:red;" ></div>
</div>
<canvas id="myCanvas"  class="scr" /></canvas>
</body>


<script>
	////////////////////////////////////////////////////////////
	//on File select
	////////////////////////////////////////////////////////////
	function handleFileSelect(evt){
	
		var files = evt.target.files || evt.dataTransfer.files;
		
		if(evt.type=="change"){ //by fileSelect Input
		}
		else{					//by Drag and drop
			FileDragHover(evt);
			document.getElementById("files").innerHTML = "파일" + files.length + "개";
		}
		
		document.getElementById('list').innerHTML = "";
		
		// Loop through the FileList and render image files as thumbnails.
		for (var i = 0, f; f = files[i]; i++)
		{
			// Only process image files.
			if (!f.type.match('image.*')) {
				continue;
			}

			var reader = new FileReader();
			var theFile = f; //for closure
			reader.onload = function(e){
				var span = document.createElement('span');
				var img = document.createElement('img');
				img.className = "thumb";
				img.src = e.target.result;
				img.addEventListener("click", onImageSelect);
				span.appendChild(img);
				document.getElementById('list').insertBefore(span, null);
			};
			
			// Read in the image file as a data URL.
			reader.readAsDataURL(f);
			
		}
	}
	
	////////////////////////////////////////////////////////////
	//load Image
	////////////////////////////////////////////////////////////
	function loadImage(dataURL){
		var canvas = document.getElementById("myCanvas");
		var imgObj = new Image();
		imgObj.onload  = function( e ){
			canvas.width  = imgObj.width;
			canvas.height  = imgObj.height;
			var context = canvas.getContext("2d");
			context.drawImage(imgObj, 0,0);
			//canvas.toDataURL("image/png");
			runImageProc();
		}
		imgObj.src = dataURL;
	}
	
	////////////////////////////////////////////////////////////
	//convert image data
	////////////////////////////////////////////////////////////
	function runImageProc(){
		var canvas = document.getElementById("myCanvas");
		var w = canvas.width;
		var h = canvas.height;
		var ctx = canvas.getContext("2d");
		var imgData = ctx.getImageData(0, 0, w, h );
		

		//Convert Pixels
		
		for(y=0;y<h;y++)
		{
			for(x=0;x<w;x++)
			{
				var index = (x + y * imgData.width) * 4;
				var r = imgData.data[index+0];
				var g = imgData.data[index+1];
				var b = imgData.data[index+2];
				var a = imgData.data[index+3];
				
				//calculate brightness (0x00~0xFF);
				var brightness = (r+g+b)/3;
				
				imgData.data[index+0] = 0;
				imgData.data[index+1] = 0;
				imgData.data[index+2] = 0;
				imgData.data[index+3] = 0xFF-brightness;
			}
		}
		
		ctx.putImageData(imgData, 0, 0);
		
		
	}
	
	////////////////////////////////////////////////////////////
	//on roll over
	////////////////////////////////////////////////////////////
	function FileDragHover(e) {
		e.stopPropagation();
		e.preventDefault();
		e.currentTarget.className = (e.type == "dragover" ? "dragBoxHover" : "dragBox");
	}
	
	////////////////////////////////////////////////////////////
	//on Image Select
	////////////////////////////////////////////////////////////
	var curImg = null;
	function onImageSelect(e){
		if(curImg != null){
			curImg.className = "thumb";
		}
		e.currentTarget.className = "thumbSelected";
		curImg = e.currentTarget;
		
		loadImage(curImg.src);
	}

	$(function() {
		gradX('#gradx', {
			sliders: [
			   {
				 color: "rgb(0, 0, 0)",
				 position: 0
			   },
			   {
				 color: "rgb(255, 255, 255)",
				 position: 100
			   }
			]			
		})
		$(".gradx_slectboxes").remove();
		$("#gradx_show_code").remove();
		//$("#gradx").dialog({"title":"그라데이션 지정", "width":510, "height":500 });
		document.getElementById('files').addEventListener('change', handleFileSelect, false);
		var filedrag = document.getElementById("dragDiv");
		filedrag.addEventListener("dragover", FileDragHover, false);
		filedrag.addEventListener("dragleave", FileDragHover, false);
		filedrag.addEventListener("drop", handleFileSelect, false);	

		$("#gradx_stop_sliders_gradx").before("<div id='grayBar'></div>")
		$("#proc_run_button").on("click", function(){
			var colorArr = [];
			for( i in gradx.sliders ){
				var obj = gradx.sliders[i]
				var colorStr = obj[0]
				var position = obj[1]
				var values = colorStr.match(/[\d\.]+/g);
				if(colorStr.indexOf('rgba')==0){

				}else{

				}
				alert(colorStr+"\n"+JSON.stringify(values) + ":" + position)
			}

		})
	    //$( "div, p" ).disableSelection();
	
	});
</script>